<!--suppress JSAnnotator -->
<template>
<!-- Page, data-name contains page name which can be used in callbacks -->
    <div class="page " data-name="asset-rating"> <!-- page-with-subnavbar -->
    <!-- Top Navbar -->
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link icon-only back">
                        <i class="if-not-ios f7-icons icon-header-arrow-back"></i>
                        <i class="if-ios icon icon-back"></i>
                    </a>
                </div>
                <div class="title sliding">{{@global.LANGUAGE.ASSET_STATUS_LIVE_MSG10}}</div>

            </div>
        </div>

        <div class="toolbar tabbar toolbar-top">
            <div class="toolbar-inner">
                <a href="#tab-per-day" class="tab-link tab-link-active">
                    {{@global.LANGUAGE.ASSET_RATING_MSG00}}
                </a>
                <a href="#tab-per-week" class="tab-link">
                    {{@global.LANGUAGE.ASSET_RATING_MSG01}}
                </a>
            </div>
        </div>


        <div class="tabs-animated-wrap">
            <div class="tabs">
                <div class="page-content tab tab-active" id="tab-per-day">
                    {{#unless SummaryPerDayLoaded}}
                    <div class="progressbar-infinite color-custom"></div>
                    <div key="skeleton-per-day">
                        <div class="block skeleton-text skeleton-effect-blink">
                        <div class="skeleton-block" style="width: 200px; height: 100px; margin: auto; border-radius: 100px 100px 0 0"></div>
                        </div>
                        <div class="block-title text-align-center skeleton-text skeleton-effect-blink">
                            some title here
                        </div>
                        <div class="block text-align-center skeleton-text skeleton-effect-blink">
                            stars template here
                        </div>
                        <div key="skeleton-per-day" class="list no-hairline-bottom no-hairline-top no-margin-top">
                            <ul>
                                {{#each '123'}}
                                <li class="item-content skeleton-text skeleton-effect-blink">
                                    <div class="item-media text-color-lightgray">
                                        <div class="skeleton-block" style="width: 25px; height: 25px;"></div>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">object name</div>
                                        <div class="item-after">obj val</div>
                                    </div>
                                </li>
                                {{/each}}
                            </ul>
                        </div>
                    </div>

                    {{else}}

                    <div key="key-gauge-wrapper-per-day" class="block">
                        <div class="row">
                            <div class="col text-align-center">
                                <div
                                  class="gauge gauge-init"
                                  data-type="semicircle"
                                  data-value="{{PerDayGauge.value}}"
                                  data-value-text="{{PerDayGauge.valueText}}"
                                  data-value-text-color="#333"
                                  data-border-color="{{PerDayGauge.borderColor}}"
                                  data-border-width="15"
                                  data-label-text="{{@global.LANGUAGE.ASSET_RATING_MSG06}}"
                                  data-label-text-color="#8e8e93"
                                ></div>
                            </div>
                        </div>
                    </div>
                    <div class="block-title text-align-center text-transform-uppercase">
                        {{@global.LANGUAGE.ASSET_STATUS_LIVE_MSG10}}
                    </div>
                    <div class="block text-align-center">
                        {{PerDayStars.template}}
                    </div>
                    <div class="list list-custom no-hairlines no-margin-top">
                        <ul>
                            {{#SummaryPerDay}}
                            <li>
                                <div class="item-content">
                                    <div class="item-media text-color-lightgray">{{#if Icon}}<i class="f7-icons {{Icon}}"></i>{{/Icon}}</div>
                                    <div class="item-inner">
                                        <div class="item-title">{{Name}}</div>
                                        <div class="item-after">{{Value}}</div>
                                    </div>
                                </div>
                            </li>
                            {{else}}
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">{{@gloabl.LANGUAGE.PROMPT_MSG072}}</div>
                                    </div>
                                </div>
                            </li>
                            {{/SummaryPerDay}}
                        </ul>
                    </div>
                    {{/unless}}
                </div>

                <div class="page-content tab" id="tab-per-week">
                    {{#unless SummaryPerWeekLoaded}}
                    <div class="progressbar-infinite color-custom"></div>
                    <div key="skeleton-per-week">
                        <div class="block skeleton-text skeleton-effect-blink">
                            <div class="skeleton-block" style="width: 200px; height: 100px; margin: auto; border-radius: 100px 100px 0 0"></div>
                        </div>
                        <div class="block-title text-align-center skeleton-text skeleton-effect-blink">
                            some title here
                        </div>
                        <div class="block text-align-center skeleton-text skeleton-effect-blink">
                            stars template here
                        </div>
                        <div class="list no-hairline-bottom no-hairline-top no-margin-top">
                            <ul>
                                {{#each '123'}}
                                <li class="item-content skeleton-text skeleton-effect-blink">
                                    <div class="item-media text-color-lightgray">
                                        <div class="skeleton-block" style="width: 25px; height: 25px;"></div>
                                    </div>
                                    <div class="item-inner">
                                        <div class="item-title">object name</div>
                                        <div class="item-after">obj val</div>
                                    </div>
                                </li>
                                {{/each}}
                            </ul>
                        </div>
                    </div>

                    {{else}}

                    <div key="key-gauge-wrapper-per-week" class="block">
                        <div class="row">
                            <div class="col text-align-center">
                                <div
                                  class="gauge gauge-init"
                                  data-type="semicircle"
                                  data-value="{{PerWeekGauge.value}}"
                                  data-value-text="{{PerWeekGauge.valueText}}"
                                  data-value-text-color="#333"
                                  data-border-color="{{PerWeekGauge.borderColor}}"
                                  data-border-width="15"
                                  data-label-text="{{@global.LANGUAGE.ASSET_RATING_MSG06}}"
                                  data-label-text-color="#8e8e93"
                                ></div>
                            </div>
                        </div>
                    </div>
                    <div class="block-title text-align-center text-transform-uppercase">
                        {{@global.LANGUAGE.ASSET_STATUS_LIVE_MSG10}}
                    </div>
                    <div class="block text-align-center">
                        {{PerWeekStars.template}}
                    </div>
                    <div key="summary-list-per-week" class="list list-custom no-hairlines no-margin-top">
                        <ul>
                            {{#SummaryPerWeek}}
                            <li>
                                <div class="item-content">
                                    <div class="item-media text-color-lightgray">{{#if Icon}}<i class="f7-icons {{Icon}}"></i>{{/Icon}}</div>
                                    <div class="item-inner">
                                        <div class="item-title">{{Name}}</div>
                                        <div class="item-after">{{Value}}</div>
                                    </div>
                                </div>
                            </li>
                            {{else}}
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">{{@gloabl.LANGUAGE.PROMPT_MSG072}}</div>
                                    </div>
                                </div>
                            </li>
                            {{/SummaryPerWeek}}
                        </ul>
                    </div>
                    {{/unless}}
                </div>

            </div>
        </div>

    </div>



</template>


<script>
  // script must return component object
    return {
        data: function () {
            var self = this;

            var ret = {
                SummaryPerDayLoaded: false
            };

            /*ret = self.$app.methods.getFromStorage('userInfo');
            ret.TimeZoneList = Protocol.Helper.getTimezoneList(ret.TimeZone);
            ret.CurrentFormButtonSubmit = 'submit-form-user';*/

            return ret;
        },

        methods: {
            getGaugeRaitingDetails: function(raiting){
                raiting = parseInt(raiting);
                var ret = {
                    value: 0,
                    borderColor: '#BC2132',
                    valueText: 0,
                };

                ret.valueText = raiting;
                ret.value = raiting / 100;
                switch(true) {
                    case ( ret.value >= 0.75 ):
                        ret.borderColor = '#39B54A';
                        break;

                    case ( ret.value >= 0.5 ):
                        ret.borderColor = '#F7931E';
                        break;
                }

                return ret;
            },
            getStars: function (raiting){
                raiting = parseInt(raiting);
                var ret = {
                    value: 0,
                    template: '',
                    color: '',
                };
                let raitingVal = raiting / 100;
                switch(true) {
                    case ( raitingVal >= 0.9 ):
                        ret.value = 5;
                        ret.color = 'text-color-green';
                        break;

                    case ( raitingVal >= 0.7 ):
                        ret.value = 4;
                        ret.color = 'text-color-green';
                        break;

                    case ( raitingVal >= 0.5 ):
                        ret.value = 3;
                        ret.color = 'text-color-orange';
                        break;

                    case ( raitingVal >= 0.3 ):
                        ret.value = 2;
                        ret.color = 'text-color-red';
                        break;

                    default:
                        ret.value = 1;
                        ret.color = 'text-color-red';
                }

                for (var i = 1; i <= 5; i++) {
                    if (i <= ret.value) {
                        ret.template += `<i class="f7-icons icon-rating margin-horizontal-half ${ ret.color }"></i>`;
                    }else{
                        ret.template += '<i class="f7-icons icon-rating margin-horizontal-half text-color-gray"></i>';
                    }
                }

                return ret;
            },
            /*saveUserDetails: function(data){
                var self = this;

                self.$app.preloader.show();
                self.$app.request.promise.get(API_URL.EDIT_ACCOUNT, data, 'json')
                    .then(function (result) {
                        if(result.data.MajorCode === '000') {
                            var userInfo = self.$app.methods.getFromStorage('userInfo');
                            self.$app.utils.extend(userInfo, data);
                            self.$app.methods.setInStorage({name:'userInfo', data: userInfo });
                            mainView.router.back();
                        }else if(result.data.MajorCode === '100' && result.data.MinorCode === '1002'){
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG114);
                        }else{
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG023 + `<br>MajorCode: ${result.data.MajorCode}<br>MinorCode: ${result.data.MinorCode}<br>${result.data.Data}`);
                        }

                    })
                    .finally(function () {
                        self.$app.preloader.hide();
                    })
                    .catch(function (err) {
                        console.log(err);
                        if (err && err.status === 404){
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG002);
                        }else{
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG003);
                        }
                    });
            },
            saveNewPassword: function(data){
                var self = this;

                self.$app.preloader.show();
                self.$app.request.promise.get(API_URL.RESET_PASSWORD, data, 'json')
                    .then(function (result) {
                        if(result.data.MajorCode === '000') {
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG055, function(){
                                self.$app.methods.logout();
                                mainView.router.back();
                            });
                        }else if(result.data.MajorCode === '100' && result.data.MinorCode === '1004'){
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG056);
                        }else{
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG023 + `<br>MajorCode: ${result.data.MajorCode}<br>MinorCode: ${result.data.MinorCode}<br>${result.data.Data}`);
                        }
                    })
                    .finally(function () {
                        self.$app.preloader.hide();
                    })
                    .catch(function (err) {
                        console.log(err);
                        if (err && err.status === 404){
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG002);
                        }else{
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG003);
                        }
                    });
            },*/

        },

        on: {
            pageInit: function (e, page) {
                var self = this;

                setTimeout( () => {
                    this.$setState({
                        SummaryPerDayLoaded: true,
                        SummaryPerDay: [
                            {
                                Icon: 'icon-braking',
                                Name: LANGUAGE.ASSET_RATING_MSG02,
                                Value: 1 ? 1 : LANGUAGE.COM_MSG083,
                            },{
                                Icon: 'icon-live-speed',
                                Name: LANGUAGE.ASSET_RATING_MSG03,
                                Value: 1 ? 1 : LANGUAGE.COM_MSG083,
                            },{
                                Icon: 'icon-live-duration',
                                Name: LANGUAGE.ASSET_RATING_MSG04,
                                Value: 1 ? 1 : LANGUAGE.COM_MSG083,
                            },{
                                Icon: 'icon-live-distance',
                                Name: LANGUAGE.ASSET_RATING_MSG05,
                                Value: 1 ? 1 : LANGUAGE.COM_MSG083,
                            },
                        ],
                        PerDayGauge: this.getGaugeRaitingDetails(75),
                        PerDayStars: this.getStars(75),

                        SummaryPerWeekLoaded: true,
                        SummaryPerWeek: [
                            {
                                Icon: 'icon-braking',
                                Name: LANGUAGE.ASSET_RATING_MSG02,
                                Value: 10 ? 10 : LANGUAGE.COM_MSG083,
                            },{
                                Icon: 'icon-live-speed',
                                Name: LANGUAGE.ASSET_RATING_MSG03,
                                Value: 10 ? 10 : LANGUAGE.COM_MSG083,
                            },{
                                Icon: 'icon-live-duration',
                                Name: LANGUAGE.ASSET_RATING_MSG04,
                                Value: 10 ? 10 : LANGUAGE.COM_MSG083,
                            },{
                                Icon: 'icon-live-distance',
                                Name: LANGUAGE.ASSET_RATING_MSG05,
                                Value: 10 ? 10 : LANGUAGE.COM_MSG083,
                            },
                        ],
                        PerWeekGauge: this.getGaugeRaitingDetails(35),
                        PerWeekStars: this.getStars(35),
                    })
                }, 1000)


                /*var profileForm = page.$pageEl.find('[name = "user-profile-form"]');
                var passwordForm = page.$pageEl.find('[name = "user-password-form"]');
                var tabs = page.$pageEl.find('.tab');

                tabs.on('tab:show', function(){
                    if (this.name === 'user-password-form') {
                        self.$setState({
                            CurrentFormButtonSubmit: 'submit-form-password'
                        });
                    }else{
                        self.$setState({
                            CurrentFormButtonSubmit: 'submit-form-user'
                        });
                    }
                });

                profileForm.on('submit', function (e) {
                    e.preventDefault();

                    var data = {
                        MajorToken: self.$app.data.MajorToken,
                        MinorToken: self.$app.data.MinorToken,
                        FirstName: page.$el.find('input[name="FirstName"]').val(),
                        SurName: page.$el.find('input[name="SurName"]').val(),
                        Mobile: page.$el.find('input[name="Mobile"]').val(),
                        Email: page.$el.find('input[name="Email"]').val(),
                        Address0: page.$el.find('input[name="Address0"]').val(),
                        Address1: page.$el.find('input[name="Address1"]').val(),
                        Address2: page.$el.find('input[name="Address2"]').val(),
                        Address3: page.$el.find('input[name="Address3"]').val(),
                        Address4: page.$el.find('input[name="Address4"]').val(),
                        TimeZone: page.$el.find('[name="TimeZone"]').val(),

                    };
                   // console.log(data);
                    self.saveUserDetails(data);

                    return false;
                });

                passwordForm.on('submit', function (e) {
                    e.preventDefault();
                   // var userInfo = self.$app.methods.getFromStorage('userInfo');
                    var data = {
                        MinorToken: self.$app.data.MinorToken,
                        oldpwd: page.$el.find('input[name="oldpwd"]').val(),
                        newpwd: page.$el.find('input[name="newpwd"]').val(),
                    };
                    var confirmpwd = page.$el.find('input[name="confirmpwd"]').val();

                    if (data.newpwd.length < 6) {
                        self.$app.dialog.alert(LANGUAGE.PROMPT_MSG054);
                        return false;
                    }
                    if (data.newpwd !== confirmpwd) {
                        self.$app.dialog.alert(LANGUAGE.PROMPT_MSG053);
                        return false;
                    }

                    self.saveNewPassword(data);

                    return false;
                });*/

            },
        }
    };
</script>
